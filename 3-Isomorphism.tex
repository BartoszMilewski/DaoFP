\documentclass[DaoFP]{subfiles}
\begin{document}
\setcounter{chapter}{2}


\chapter{Isomorphisms}

When we say that 
\[f \circ (g \circ h) = (f \circ g) \circ h \]
or
\[ f = f \circ id \]
we are asserting the \emph{equality} of arrows. The arrow on the left is the result of one operation, and the arrow on the right is the result of another. But the results are \emph{equal}.

We often illustrate such equalities by drawing \emph{commuting} diagrams, e.g.,

\[
 \begin{tikzcd}
 A
 \arrow[r, "h"]
 \arrow[rr, bend left=45, "g \circ h"]
 \arrow[rrr, bend left=80, "f \circ (g \circ h)"]
 \arrow[rrr, bend right=80, "(f \circ g) \circ h"]
 & B
 \arrow[r, "g"]
 \arrow[rr, bend right=45, "f \circ g"]
 &C
 \arrow[r, "f"]
 &D
 \end{tikzcd}
 \begin{tikzcd}
 A
 \arrow[r, "f"]
 \arrow[r, loop, "id"']
 &B
 \end{tikzcd}
\]

Thus we compare arrows for equality.

We do \emph{not} compare objects for equality. We see objects as confluences of arrows, so if we want to compare two objects, we look at the arrows.

\section{Isomorphic Objects}

The simplest relation between two objects is an arrow.

The simplest round trip is a composition of two arrows going in opposite directions. 

\[
 \begin{tikzcd}
 A
 \arrow[r, bend left, "f"]
 & B
 \arrow[l, bend left, "g"]
 \end{tikzcd}
\]

There are two possible round trips. One is $g \circ f$, which goes from $A$ to $A$. The other is $f \circ g$ , which goes from $B$ to $B$.

If both of them result in identities, than we say that $g$ is the \emph{inverse} of $f$
\[ g \circ f = id_A\]
\[f \circ g = id_B\]
and we write it as $g = f^{-1}$ (pronounced $f$ \emph{inverse}). The arrow $ f^{-1}$ undoes the work of the arrow $f$. 

Such a pair of arrows is called an \emph{isomorphism} and the two objects are called \emph{isomorphic}.

What does the existence of an isomorphisms tell us about the two objects they connect? 

We have said that objects are described by their interactions with other objects. So let's consider what the two isomorphic objects look like from the perspective of an observer object $X$. Take an arrow $h$ coming from $X$ to $A$.

\[
 \begin{tikzcd}
 & X
 \arrow[ld, "h"']
 \\
 A
 \arrow[rr, "f"]
  && B
 \arrow[ll, bend left,  "f^{-1}"]
 \end{tikzcd}
\]
There is a corresponding arrow coming from $X$ to $B$. It's just the composition of $f \circ h$, or the action of $(f \circ -)$ on $h$.
\[
 \begin{tikzcd}
 & X
 \arrow[ld, "h"']
 \arrow[rd, "f \circ h"]
 \\
 A
 \arrow[rr, "f"]
  && B
 \arrow[ll, bend left,  "f^{-1}"]
 \end{tikzcd}
\]
Similarly, for any arrow probing $B$ there is a corresponding arrow probing $A$. It is given by the action of  $(f^{-1} \circ -)$. 

We can move focus back and forth between $A$ and $B$ using the mappings $(f \circ -)$ and $(f^{-1} \circ -)$.

We can combine these two mappings (see exercise \ref{ex-yoneda-composition}) to form a round trip. The result is the same as if we applied the composite $((f^{-1} \circ f) \circ -)$. But this is equal to $(id_A \circ  -)$ which, as we know from exercise \ref{ex-yoneda-identity}, leaves the arrows unchanged.

Similarly, the round trip induced by $f \circ f^{-1}$ leaves the arrows $X \to B$ unchanged. 

This creates a ``buddy system'' between the two groups of arrows. Imagine each arrow sending a message to its buddy, as determined by $f$ or $f^{-1}$. Each arrow would then receive exactly one message, and it would be a message from its buddy. No arrow would be left behind, and no arrow would receive more than one message. Mathematicians call this kind of buddy system a \emph{bijection} or one-to-one correspondence.

Therefore, arrow by arrow, the two objects $A$ and $B$ look exactly the same from the perspective of $X$. Arrow-wise, there is no difference between the two objects. 

In particular, if you replace $X$ with the terminal object $1$, you'll see that the two objects have the same elements. For every element $x \colon 1 \to A$ there is a corresponding element $y \colon 1 \to B$, namely $y = f \circ x$, and vice versa. There is a bijection between the elements of isomorphic objects.

Such indistinguishable objects are called \emph{isomorphic} because they have ``the same shape.'' You've seen one, you've seen them all. 

We write this isomorphism as:

\[A \cong B\]

When dealing with objects, we use isomorphism in place of equality.

In programming, two isomorphic types have the same external behavior. One type can be implemented in terms of the other and vice versa. One can be replaced by the other without changing the behavior of the system (except, possibly, the performance). 

In classical logic, if B follows from A and A follows from B then A and B are logically equivalent. We often say that B is true ``if and only if'' A is true. However, unlike previous parallels between logic and type theory, this one is not as straightforward if you consider proofs to be relevant. In fact, it led to the development of a new branch of fundamental mathematics, homotopy type theory, or HoTT for short.

\begin{exercise}
Make an argument that there is a bijection between arrows that are \emph{outgoing} from two isomorphic objects. Draw the corresponding diagrams.
\end{exercise}


\begin{exercise}
Show that every object is isomorphic to itself
\end{exercise}

\begin{exercise}
If there are two terminal objects, show that they are isomorphic
\end{exercise}

\begin{exercise}
Show that the isomorphism from the previous exercise is unique.
\end{exercise}

\section{Naturality}

We've seen that, when two objects are isomorphic, we can switch focus from one to another using post-composition: either $(f \circ -)$ or $(f^{-1} \circ -)$. 

Conversely, to switch between different observers, we use pre-composition. 

Indeed, an arrow $h$ probing $A$ from $X$ is related to the arrow $h\circ g$ probing the same object from $Y$.

\[
 \begin{tikzcd}
 X
 \arrow[d, "h"']
 && Y
 \arrow[ll, "g"']
  \arrow[dll, "h \circ g"']
 \\
 A
 \arrow[rr, "f"]
  && B
 \arrow[ll, bend left,  "f^{-1}"]
 \end{tikzcd}
\]
Similarly, an arrow $h'$ probing $B$ from $X$ corresponds to the arrow $h' \circ g$ probing it from $Y$. 

\[
 \begin{tikzcd}
 X
 \arrow[drr, "h'"]
 && Y
 \arrow[ll, "g"']
  \arrow[d, "h' \circ g"]
 \\
 A
 \arrow[rr, "f"]
  && B
 \arrow[ll, bend left,  "f^{-1}"]
 \end{tikzcd}
\]
In both cases, we change perspective from $X$ to $Y$ by applying precomposition $(- \circ g)$.

The important observation is that the change of perspective preserves the buddy system established by the isomorphism. If two arrows were buddies from the perspective of $X$, they are still buddies from the perspective of $Y$. This is as simple as saying that it doesn't matter if you first pre-compose with $g$ (switch perspective) and then post-compose with $f$ (switch focus), or first post-compose with $f$ and then pre-compose with $g$. Symbolically, we write it as:

\[(- \circ g) \circ (f \circ -) = (f \circ -) \circ (- \circ g)\]
and we call it the \emph{naturality} condition.

The meaning of this equation is revealed when you apply it to a morphism $h \colon X \to A$. Both sides evaluate to $f \circ h \circ g$.  \[
 \begin{tikzcd}
 Y \arrow[r, "g"] &X \arrow[r, "h"] & A \arrow[r, "f"] & B
\end{tikzcd}
\]

Here, the naturality condition is just an identity, but we'll soon see it generalized to less trivial circumstances.


Arrows are used to broadcast information about an isomorphism. Naturality tells us that all objects get a consistent view of it, independent of the path. 

We can also reverse the roles of observers and subjects. For instance, using an arrow $h \colon A \to X$, the object $A$ can probe an arbitrary object $X$. If there is an arrow $g \colon X \to Y$, it can switch focus to $Y$. Switching the perspective to $B$ is done by precomposition with $f^{-1}$.
\[
 \begin{tikzcd}
 A
 \arrow[rr, "f"]
 \arrow[d, "h"']
 \arrow[rrd, "g\circ h"]
 && B
  \arrow[ll, bend right,  "f^{-1}"']
 \\
 X
 \arrow[rr, "g"']
  && Y
 \end{tikzcd}
\]
Again, we have the naturality condition, this time from the point of view of the isomorphic pair:
\[(- \circ f^{-1}) \circ (g \circ -) = (g \circ -) \circ (- \circ f^{-1}) \]

\begin{exercise}
Show that both sides of the naturality condition for $f^{-1}$, when acting on $h$, reduce to:
\[
 \begin{tikzcd}
 Y \arrow[r, "g"] &X \arrow[r, "h"] & B \arrow[r, "f^{-1}"] & A
\end{tikzcd}
\]

\end{exercise}

\section{Reasoning with Arrows}

Master Yoneda says: ``At the arrows look!''

If two objects are isomorphic, they have the same sets of incoming arrows. 

If two objects are isomorphic, they also have the same sets of outgoing arrows.

If you want to see if two objects are isomorphic, at the arrows look!

\medskip

Suppose that you don't know if two objects are isomorphic but you were able to, for any observer $X$, establish an invertible mapping $\alpha_X$ of arrows $X \to A$ to arrows $X \to B$. 
\[
 \begin{tikzcd}
 X
 \arrow[d, "h"']
 \arrow[rrd, "\alpha_X h"]
  \\
 A
  && B
 \end{tikzcd}
\]
This mapping, along with its inverse $\alpha^{-1}_X$, which takes arrows $X \to B$ to arrows $X \to A$, would play the role of $(f \circ -)$ and $(f^{-1} \circ -)$, if those morphisms existed. So the family of maps $\alpha$ describes an ``artificial'' way of switching focus between our two objects.

Here's the same situation from the point of view of another observer $Y$:
\[
 \begin{tikzcd}
 X
  && Y
 \arrow[lld, "h'"']
 \arrow[d, "\alpha_Y h'"]
 \\
 A
  && B
 \end{tikzcd}
\]
Notice that $Y$ is using the mapping $\alpha_Y$ to switch focus from $A$ to $B$. These two mappings, $\alpha_X$ and $\alpha_Y$, become entangled whenever there is a morphism $g \colon Y \to X$. In that case, pre-composition with $g$ allows us to switch perspective from $X$ to $Y$ (notice the direction)

\[
 \begin{tikzcd}
 X
 \arrow[d, "h"']
 && Y
 \arrow[ll, "g"']
 \arrow[lld, "h \circ g"]
 \\
 A
  && B
 \end{tikzcd}
\]
We have separated the switching of focus from the switching of perspective. The former is done by $\alpha$, the latter by pre-composition.

But now, starting with some $h$, we can either apply $(- \circ g)$ to switch to $Y$'s point of view, and the apply $\alpha_Y$ to switch focus to $B$
\[ \alpha_Y \circ (- \circ g) \]
or we can first let $X$ switch focus to $B$ using $\alpha_X$, and then switch perspective using $(- \circ g)$
\[ (- \circ g) \circ \alpha_X \]
In both cases we end up looking at $B$ from $Y$. We've done this exercise before, when we had an isomorphism between $A$ and $B$, and we've found out that the results were the same. We called it the naturality condition. So if we want the $\alpha$s to give us an isomorphism, we should impose the equivalent naturality condition:
\[ \alpha_Y \circ (- \circ g) = (- \circ g) \circ \alpha_X \]
Or, when acting on some arrow $h \colon X \to A$:
\[\alpha_Y(h \circ g) = (\alpha_X h) \circ g \]
This way, if we replace all $\alpha$s with $(f \circ -)$, things will work out. 

And indeed they do! In fact, we can proceed to reconstruct $f$ from the $\alpha$s. Since $\alpha_X$ is defined for any object $X$, it is also defined for $A$. By definition, $\alpha_A$ takes a morphism $A \to A$ to a morphism $A \to B$. We know for sure that there is at least one such morphism, namely the identity $id_A$. The isomorphism $f$ we are seeking is
\[f = \alpha_A (id_A)\]
or, pictorially,
\[
 \begin{tikzcd}
 A
 \arrow[d, "id_A"']
 \arrow[rrd, "f = \alpha_A (id_A)"]
  \\
 A
  && B
 \end{tikzcd}
\]
But if this is indeed an isomorphism then our $\alpha_X$ should be equal to  $(f \circ -)$ for any $X$. And indeed it is! Let's rewrite the naturality condition replacing $X$ with $A$. We get
\[\alpha_Y(h \circ g) = (\alpha_A h) \circ g \]
Since both the source and the target of $h$ is $A$, we are free to pick $id_A$
\[\alpha_Y (id_A \circ g) = (\alpha_A (id_A)) \circ g \]
But this is simply
\[\alpha_Y g = f \circ g = (f \circ -) g\]
In other words, $\alpha_Y = (f \circ -)$ for every object $Y$ and every morphism $g \colon Y \to A$

Even though $\alpha_X$ was defined individually for every $X$ and every arrow $X \to A$, it turned out to be completely determined by its value at a single identity arrow. This is the strength of naturality!
\subsection{Reversing the Arrows}
As Lao Tzu would say, an observer cannot exist without the observed, and this duality cannot be complete unless the observer is allowed to switch roles the observed. 

Again, we want to show that two objects $A$ and $B$ are isomorphic, but this time we want to treat them as observers. An arrow $h \colon A \to X$ probes an arbitrary object $X$ from the perspective of $A$. When we knew that the two objects were isomorphic, we were able to switch perspective to $B$ using $(- \circ f^{-1})$. This time we have at our disposal a transformation $\beta_X$ instead.
\[
 \begin{tikzcd}
 A
 \arrow[d, "h"']
 && B
 \arrow[lld, "\beta_X h"]
 \\
 X
  \end{tikzcd}
\]
Similarly, if we want to observe another object, $Y$, we will use $\beta_Y$ to switch perspectives between $A$ and $B$, and so on. 

If the two objects $X$ and $Y$ are connected by an arrow $g \colon X \to Y$ then we also have an option of switching focus using $(g \circ -)$. If we want to both switch perspective and switch focus, there are two ways of doing it. Naturality demands that the results be equal
\[ (g \circ -) \circ \beta_X = \beta_Y \circ (g \circ -) \]
Indeed, if we replace $\beta$ with $(- \circ f^{-1})$, we recover the naturality condition for an isomorphism. 

\begin{exercise}
Use the trick with the identity morphism to recover $f^{-1}$ from the family of mappings $\beta$.
\end{exercise}
\begin{exercise}
Using $f^{-1}$ from the previous exercise, evaluate $\beta_Y g$ for an arbitrary object $Y$ and an arbitrary arrow $g \colon A \to Y$.
\end{exercise}


As Lao Tzu would say, To show an isomorphism, it is often easier to define a natural transformation between ten thousand arrows than it is to find a pair of arrows between two objects.

\end{document}